on:
    push:
    workflow_dispatch:

jobs:
  compare:
        name: Compares models https://docs.gptscript.ai/alternative-model-providers
        runs-on: ubuntu-latest
        steps:
        - uses: cpanato/gptscript-installer@main
        - uses: actions/checkout@v4
        - shell: bash
          name: Mistral
          run: ./mistral.sh
          env:
            GPTSCRIPT_PROVIDER_API_MISTRAL_AI_API_KEY: ${{ secrets.MISTRAL_API_KEY }}
            OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        - shell: bash
          name: OpenAI
          run: ./openai.sh
          env:
            OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        - shell: bash
          name: Anthropic
          run: ./anthropic.sh
          env:
            ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
            OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        - shell: bash
          name: Sanity test answers
          run: cd test; ./test.sh | sh
          env:
            OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}

        
        - name: Setup Pages
          uses: actions/configure-pages@v1
        - name: Generate report
          run: mkdir "_site" && go run generate-report/main.go > _site/index.html
        - name: Upload artifact
          uses: actions/upload-pages-artifact@v3
        - name: Deploy to GitHub Pages
          uses: actions/deploy-pages@v4
